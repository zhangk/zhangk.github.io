---
title: Linux 访问 Windows 共享文件指南
slug: 7f861dfdb4374d5c8c4f196ea1474fe0
tags:
  - linux
date: 2025-06-10T03:37:05.058Z
---

## 🔍 查看共享资源

```bash
smbclient -L //IP地址 -U 用户名
```

**示例**：

```bash
smbclient -L //192.168.1.175 -U administrator
```

**输出解析**：

- 不带 `$` 的共享名称是普通用户可访问的

- 带 `$` 的是隐藏共享（通常是系统管理共享）

***

## 📂 挂载共享文件夹

### 1. 创建挂载点

```bash
sudo mkdir -p /mnt/MYSHARE
```

### 2. 挂载命令

```bash
sudo mount -t cifs -o user=用户名,password=密码 //IP/共享名 /挂载点
```

**常用参数**：

- `user`：Windows 用户名

- `password`：Windows 密码

- `vers`：SMB 协议版本（解决兼容性问题）

- `iocharset=utf8`：支持中文文件名

- `uid`：指定用户权限

- `gid`：指定组权限

***

## 🧩 实用挂载示例

### 挂载命令

```bash
sudo mount -t cifs -o username=zhangkai,password=zhangkai,rw,uid=$(id -u),gid=$(id -g),file_mode=0755,dir_mode=0755 //192.168.0.124/zhangkai /mnt/zhangkai124
```

### 指定 SMB 协议版本

```bash
sudo mount -t cifs -o user=THZY,password=123456,vers=2.0 //192.168.1.175/software-server /mnt/175
```

### 支持中文文件名

```bash
sudo mount -t cifs -o username=software,vers=1.0,iocharset=utf8 //192.168.1.175/software-server-new /mnt/175-new
```

### 替代挂载命令

```bash
sudo smbmount //192.168.1.175/software-server /mnt/175 -o user=thzy,pass=thzy@boss,iocharset=utf8
```

### 验证挂载

```bash
ls /mnt/MYSHARE  # 查看共享内容
```

***

## ⏏️ 卸载共享文件夹

```bash
sudo umount /挂载点
```

**示例**：

```bash
sudo umount /mnt/224liuh
```

***

## 🔄 设置开机自动挂载

### 编辑 `/etc/fstab` 文件

```bash
sudo nano /etc/fstab
```

添加以下内容：

```bash
//IP/共享名 /挂载点 cifs 选项 0 0
```

### 示例配置

```bash
//192.168.1.175/天和致远 /mnt/175 cifs defaults,username=zhangkai@thzy.local,password=1qaz@WSX,uid=1000,gid=1000,iocharset=utf8,vers=2.0 0 0
```

**参数说明**：

- `defaults`：使用默认挂载选项

- `uid/gid`：指定用户/组ID（通过 `id -u 用户名` 查询）

- `file_mode=0777,dir_mode=0777`：设置文件/目录权限

- `nofail`：启动时忽略挂载失败

***

## ⚠️ 常见问题解决

### 1. 权限不足错误

```bash
mount error(13): Permission denied
```

**解决方案**：

- 检查 Windows 共享权限设置

- 确认用户名/密码正确

- 尝试添加 `sec=ntlm` 或 `sec=ntlmv2` 选项

### 2. 协议版本不匹配

```bash
mount error(112): Host is down
```

**解决方案**：

```bash
# 尝试不同 SMB 版本
sudo mount -t cifs -o vers=1.0 ...  # SMB1
sudo mount -t cifs -o vers=2.0 ...  # SMB2
sudo mount -t cifs -o vers=3.0 ...  # SMB3
```

### 3. 中文文件名乱码

**解决方案**：\
添加编码参数：

```bash
-o iocharset=utf8,file_mode=0777,dir_mode=0777
```

### 4. Windows 凭据错误

```bash
mount error(132): Security context not found
```

**解决方案**：

- 使用完整的用户名格式：`域名\用户名` 或 `username@domain.local`

- 在 Windows 上重置用户密码

***

## 🔧 高级技巧

### 使用凭证文件（避免密码明文）

1. 创建凭证文件：

```bash
sudo nano ~/.smbcredentials
```

内容：

```ini
username=your_username
password=your_password
domain=your_domain
```

2. 设置权限：

```bash
chmod 600 ~/.smbcredentials
```

3. 挂载时引用：

```bash
sudo mount -t cifs -o credentials=/home/user/.smbcredentials,vers=2.0 //192.168.1.100/share /mnt/share
```

### 查看当前挂载

```bash
mount | grep cifs
df -hT | grep cifs
```

### 网络诊断

```bash
# 测试网络连通性
ping 192.168.1.175

# 检查SMB端口
telnet 192.168.1.175 445
```

> **📌 最佳实践**
>
> 1. 优先使用 `vers=2.0` 或 `vers=3.0`（更安全）
>
> 2. 生产环境使用凭证文件存储密码
>
> 3. 测试成功后添加到 `/etc/fstab`
>
> 4. 使用 `nofail` 选项防止启动卡死
