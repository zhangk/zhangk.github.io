---
title: 创建和使用虚拟软盘镜像文件指南
slug: 7b3dfcf44ecf470d8b7a7f7866c12f24
tags:
  - linux
date: 2025-06-11T01:56:49.209Z
---

## 📀 创建软盘镜像文件 (三选一)

```bash
# 方式1：指定标准软盘大小
sudo dd if=/dev/zero of=test.img bs=1474560 count=1

# 方式2：按扇区计算
sudo dd if=/dev/zero of=test.img bs=512 count=2880

# 方式3：按KB计算
sudo dd if=/dev/zero of=test.img bs=1024 count=1440
```

> **注意**：三种方式创建的镜像文件完全相同（1.44MB标准软盘）

## 🛠️ 在镜像上建立文件系统

```bash
# 创建ext4文件系统
sudo mkfs.ext4 test.img

# 或创建FAT文件系统
sudo mkfs.vfat test.img
```

## 📂 挂载与文件操作

```bash
# 创建挂载点
mkdir test_dir

# 挂载镜像文件 (ext4示例)
sudo mount test.img test_dir -o loop -t ext4

# 挂载镜像文件 (FAT示例)
sudo mount test.img test_dir -o loop -t vfat

# 操作文件系统
sudo cp your_file.txt test_dir/  # 复制文件
sudo nano test_dir/new_file.txt  # 创建新文件

# 完成后卸载
sudo umount test_dir
```

## ⚠️ 重要注意事项

1. **权限要求**：所有命令需使用`sudo`

2. **空间分配**：`bs`和`count`参数决定镜像大小，可自定义：

   ```bash
   sudo dd if=/dev/zero of=custom.img bs=1M count=10  # 创建10MB镜像
   ```

3. **文件系统选择**：

   - `ext4`：Linux专用，支持权限/日志

   - `vfat`：跨平台兼容(Windows/Mac/Linux)

4. **挂载参数**：必须使用`-o loop`选项

5. **资源释放**：操作后务必`umount`避免数据损坏

## 🔄 完整工作流示例

```bash
# 创建20MB自定义镜像
sudo dd if=/dev/zero of=data.img bs=1M count=20

# 格式化为FAT32
sudo mkfs.vfat -F 32 data.img

# 挂载并操作
mkdir my_data
sudo mount data.img my_data -o loop -t vfat
sudo cp -R documents/ my_data/
sudo umount my_data

# 检查内容
sudo mount data.img my_data -o loop
ls my_data  # 应显示复制的文件
sudo umount my_data
```

> **原理说明**：\
> 使用`/dev/zero`生成空字节流 → `dd`输出到镜像文件 →\
> 文件系统格式化 → 通过loop设备挂载为真实目录
