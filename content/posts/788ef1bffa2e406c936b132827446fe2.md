---
title: Android 12 MTK å¹³å°ï¼šæ¸…é™¤å¤šä»»åŠ¡æ æ—¶å¼ºåˆ¶åœæ­¢æŒ‡å®šåº”ç”¨
slug: 788ef1bffa2e406c936b132827446fe2
tags:
  - android
date: 2026-01-27T09:14:55.867Z
---

### ğŸ“Œ ä¿®æ”¹ç›®çš„

åœ¨æ¸…é™¤å¤šä»»åŠ¡æ ï¼ˆRecent Tasksï¼‰æ—¶ï¼Œå¯¹ç‰¹å®šåº”ç”¨è¿›è¡Œå¼ºåˆ¶åœæ­¢ï¼ˆ`forceStopPackage`ï¼‰ï¼Œä»¥ç¡®ä¿å…¶åœ¨åå°å½»åº•é€€å‡ºï¼Œé¿å…æ®‹ç•™è¿›ç¨‹å½±å“ç³»ç»Ÿæˆ–ç”¨æˆ·ä½“éªŒã€‚

***

### ğŸ“‚ ä¿®æ”¹æ–‡ä»¶æ¸…å•

ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹ï¼š

1. `frameworks/base/data/etc/com.android.launcher3.xml`

2. `vendor/mediatek/proprietary/packages/apps/Launcher3/AndroidManifest-common.xml`

3. `vendor/mediatek/proprietary/packages/apps/Launcher3/quickstep/src/com/android/quickstep/views/RecentsView.java`

***

### ğŸ“„ å®Œæ•´ diff å†…å®¹

```diff
diff --git a/alps/frameworks/base/data/etc/com.android.launcher3.xml b/alps/frameworks/base/data/etc/com.android.launcher3.xml
index 598d2027a0e..fb8af50cacd 100644
--- a/alps/frameworks/base/data/etc/com.android.launcher3.xml
+++ b/alps/frameworks/base/data/etc/com.android.launcher3.xml
@@ -24,5 +24,6 @@
         <permission name="android.permission.START_TASKS_FROM_RECENTS"/>
         <permission name="android.permission.STATUS_BAR"/>
         <permission name="android.permission.STOP_APP_SWITCHES"/>
+        <permission name="android.permission.FORCE_STOP_PACKAGES"/>
     </privapp-permissions>
 </permissions>
diff --git a/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/AndroidManifest-common.xml b/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/AndroidManifest-common.xml
index d96510cd261..06168ffbc4e 100644
--- a/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/AndroidManifest-common.xml
+++ b/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/AndroidManifest-common.xml
@@ -40,6 +40,8 @@
     <uses-permission android:name="android.permission.REQUEST_DELETE_PACKAGES" />
     <uses-permission android:name="android.permission.READ_DEVICE_CONFIG" />
     <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" />
+    <!-- å…è®¸å¼ºåˆ¶åœæ­¢å…¶ä»–åº”ç”¨ -->
+    <uses-permission android:name="android.permission.FORCE_STOP_PACKAGES" />
 
     <!-- M: Add for MiraVision. -->
     <uses-permission android:name="com.mediatek.permission.MIRA_VISION"/>
diff --git a/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/quickstep/src/com/android/quickstep/views/RecentsView.java b/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/quickstep/src/com/android/quickstep/views/RecentsView.java
index ce79125be19..dd972439d54 100644
--- a/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/quickstep/src/com/android/quickstep/views/RecentsView.java
+++ b/alps/vendor/mediatek/proprietary/packages/apps/Launcher3/quickstep/src/com/android/quickstep/views/RecentsView.java
@@ -171,6 +171,11 @@ import java.util.ArrayList;
 import java.util.List;
 import java.util.function.Consumer;
 
+import android.app.ActivityManager;
+import android.content.ComponentName;
+import java.lang.reflect.Method;
+import android.util.Log;
+
 /**
  * A list of recent tasks.
  */
@@ -2476,6 +2481,29 @@ public abstract class RecentsView<ACTIVITY_TYPE extends StatefulActivity<STATE_T
     }
 
     private void removeTaskInternal(TaskView taskView) {
+        // æ£€æŸ¥æ˜¯å¦ä¸ºç‰¹å®šåŒ…åçš„åº”ç”¨
+        Task task = taskView.getTask();
+        if (task != null && task.key != null && task.key.baseIntent != null) {
+            ComponentName component = task.key.baseIntent.getComponent();
+            if (component != null) {
+                if ("com.jinsanhui.musiceduchuangke".equals(component.getPackageName())
+                || "com.jinsanhui.musiceduchuangke.student".equals(component.getPackageName())
+                || "org.localsend.localsend_app".equals(component.getPackageName())
+                || "com.jinsanhui.study.evaluation.student".equals(component.getPackageName())) {
+                    // å¼ºè¡Œåœæ­¢æŒ‡å®šåº”ç”¨
+                    try {
+                        ActivityManager am = (ActivityManager) getContext().getSystemService(Context.ACTIVITY_SERVICE);
+                        Method forceStopPackage = am.getClass().getMethod("forceStopPackage", String.class);
+                        forceStopPackage.invoke(am, component.getPackageName());
+                        Log.d("RecentsView", "Force stopped package: " + component.getPackageName());
+                    } catch (Exception e) {
+                        Log.e("RecentsView", "Failed to force stop package: " + component.getPackageName(), e);
+                    }
+                }
+
+            }
+        }
+        
         UI_HELPER_EXECUTOR.getHandler().postDelayed(() ->
                         ActivityManagerWrapper.getInstance().removeTask(
                                 taskView.getTask().key.id),
@@ -2533,7 +2561,25 @@ public abstract class RecentsView<ACTIVITY_TYPE extends StatefulActivity<STATE_T
         PendingAnimation anim = new PendingAnimation(duration);
 
         int count = getTaskViewCount();
+        
+        // æå‰æ”¶é›†éœ€è¦æ£€æŸ¥çš„åŒ…åä¿¡æ¯
+        List<String> packagesToForceStop = new ArrayList<>();
         for (int i = 0; i < count; i++) {
+            TaskView taskView = getTaskViewAt(i);
+            if (taskView != null) {
+                Task task = taskView.getTask();
+                if (task != null && task.key != null && task.key.baseIntent != null) {
+                    ComponentName component = task.key.baseIntent.getComponent();
+                    if (component != null) {
+                        if ("com.jinsanhui.musiceduchuangke".equals(component.getPackageName())
+                        || "com.jinsanhui.musiceduchuangke.student".equals(component.getPackageName())
+                        || "org.localsend.localsend_app".equals(component.getPackageName())
+                        || "com.jinsanhui.study.evaluation.student".equals(component.getPackageName())){
+                            packagesToForceStop.add(component.getPackageName());   
+                        }
+                    }
+                }
+            }
             addDismissedTaskAnimations(getTaskViewAt(i), duration, anim);
         }
 
@@ -2542,11 +2588,29 @@ public abstract class RecentsView<ACTIVITY_TYPE extends StatefulActivity<STATE_T
             if (isSuccess) {
                 // Remove all the task views now
                 finishRecentsAnimation(true /* toRecents */, false /* shouldPip */, () -> {
-                    UI_HELPER_EXECUTOR.getHandler().postDelayed(
-                            ActivityManagerWrapper.getInstance()::removeAllRecentTasks,
-                            REMOVE_TASK_WAIT_FOR_APP_STOP_MS);
-                    removeTasksViewsAndClearAllButton();
-                    startHome();
+                    // åœ¨åå°çº¿ç¨‹æ‰§è¡Œç³»ç»Ÿæ“ä½œå’Œå¼ºåˆ¶åœæ­¢æ£€æŸ¥
+                    UI_HELPER_EXECUTOR.getHandler().postDelayed(() -> {
+                        // é¦–å…ˆå¼ºåˆ¶åœæ­¢ç‰¹å®šåº”ç”¨
+                        for (String packageName : packagesToForceStop) {
+                            try {
+                                ActivityManager am = (ActivityManager) getContext().getSystemService(Context.ACTIVITY_SERVICE);
+                                Method forceStopPackage = am.getClass().getMethod("forceStopPackage", String.class);
+                                forceStopPackage.invoke(am, packageName);
+                                Log.d("RecentsView", "Killed background processes in clear all for package: " + packageName);
+                            } catch (Exception e) {
+                                Log.e("RecentsView", "Failed to kill processes in clear all for package: " + packageName, e);
+                            }
+                        }
+                        
+                        // ç„¶åç§»é™¤æ‰€æœ‰ä»»åŠ¡
+                        ActivityManagerWrapper.getInstance().removeAllRecentTasks();
+                        
+                        // åœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒUIæ“ä½œ
+                        MAIN_EXECUTOR.execute(() -> {
+                            removeTasksViewsAndClearAllButton();
+                            startHome();
+                        });
+                    }, REMOVE_TASK_WAIT_FOR_APP_STOP_MS);
                 });
             }
             mPendingAnimation = null;

```

### ğŸ§© ä¿®æ”¹è¯´æ˜

#### 1. æƒé™æ·»åŠ 

- åœ¨ `com.android.launcher3.xml` ä¸­æ·»åŠ ç‰¹æƒæƒé™ `android.permission.FORCE_STOP_PACKAGES` åˆ° privapp-permissions ç™½åå•ä¸­ã€‚

- åœ¨ `AndroidManifest-common.xml` ä¸­å£°æ˜ä½¿ç”¨è¯¥æƒé™ã€‚

#### 2. å¼ºåˆ¶åœæ­¢é€»è¾‘

åœ¨ `RecentsView.java` ä¸­æ–°å¢é€»è¾‘ï¼š

- **ç§»é™¤å•ä¸ªä»»åŠ¡æ—¶**ï¼ˆ`removeTaskInternal`ï¼‰ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºä»¥ä¸‹åŒ…åä¹‹ä¸€ï¼Œå¦‚æœæ˜¯åˆ™é€šè¿‡åå°„è°ƒç”¨ `ActivityManager.forceStopPackage()` å¼ºåˆ¶åœæ­¢ï¼š

  - `com.jinsanhui.musiceduchuangke`

  - `com.jinsanhui.musiceduchuangke.student`

  - `org.localsend.localsend_app`

  - `com.jinsanhui.study.evaluation.student`
- **æ¸…é™¤æ‰€æœ‰ä»»åŠ¡æ—¶**ï¼ˆ`dismissAllTasks`ï¼‰ï¼šå…ˆæ”¶é›†æ‰€æœ‰åŒ¹é…çš„åŒ…åï¼Œç„¶ååœ¨ä¸€ä¸ªåå°ä»»åŠ¡ä¸­ä¾æ¬¡å¼ºåˆ¶åœæ­¢è¿™äº›åº”ç”¨ï¼Œå†ç§»é™¤æ‰€æœ‰ä»»åŠ¡å¹¶è¿”å›æ¡Œé¢ã€‚

#### 3. ä½¿ç”¨åå°„çš„åŸå› 

`forceStopPackage` æ˜¯ç³»ç»Ÿçº§éšè— APIï¼Œå› æ­¤ä½¿ç”¨åå°„è°ƒç”¨ã€‚

***

### ğŸš¨ æ³¨æ„äº‹é¡¹

- è¯¥ä¿®æ”¹ä»…é€‚ç”¨äº **Android 12 MTK å¹³å°**ï¼Œå…¶ä»–å¹³å°æˆ–ç‰ˆæœ¬å¯èƒ½éœ€é€‚é…ã€‚

- å¼ºåˆ¶åœæ­¢åº”ç”¨å¯èƒ½å¯¼è‡´åº”ç”¨æ•°æ®ä¸¢å¤±æˆ–çŠ¶æ€å¼‚å¸¸ï¼Œè¯·ç¡®ä¿ç›®æ ‡åº”ç”¨ä¸ºå¯å®‰å…¨åœæ­¢çš„éå…³é”®åº”ç”¨ã€‚

- å¦‚éœ€æ–°å¢æˆ–åˆ é™¤ç›®æ ‡åŒ…åï¼Œè¯·ä¿®æ”¹ä»£ç ä¸­çš„åŒ…ååˆ—è¡¨ã€‚
