---
title: Debian journalctl 使用指南
slug: ea9ad1df778547d393556eb437e7e400
tags:
  - linux
date: 2025-08-13T12:17:57.587Z
---

# Debian journalctl 使用指南

> **systemd-journald** 是 systemd 的日志服务\
> **journalctl** 是查询系统日志的核心工具\
> **日志存储**：
>
> - 临时存储：`/run/log/journal/`（重启丢失）
> - 持久存储：`/var/log/journal/`（需手动创建）

## 一、基础操作

### 1. 查看日志

```bash
# 查看完整日志（实时更新）
sudo journalctl

# 实时追踪日志（类似 tail -f）
journalctl -f
```

### 2. 按服务筛选

```bash
# 查看指定服务日志
journalctl -u nginx.service

# 实时追踪服务日志
journalctl -fu sshd.service
```

### 3. 按优先级过滤

| 级别      | 数字 | 命令示例                |
| ------- | -- | ------------------- |
| EMERG   | 0  | `journalctl -p 0`   |
| ALERT   | 1  |                     |
| CRIT    | 2  |                     |
| ERR     | 3  | `journalctl -p err` |
| WARNING | 4  |                     |
| NOTICE  | 5  |                     |
| INFO    | 6  |                     |
| DEBUG   | 7  |                     |

范围筛选：`journalctl -p warning..crit`

### 4. 按时间筛选

```bash
journalctl --since "2023-10-27 09:00" --until "17:00"
journalctl --since yesterday
journalctl --since "2 hours ago" -u apache2
```

## 二、高级查询

### 1. 启动相关日志

```bash
# 查看本次启动日志
journalctl -b

# 查看上次启动日志
journalctl -b -1

# 列出所有启动记录
journalctl --list-boots
```

### 2. 特定进程日志

```bash
# 按进程ID (PID)
journalctl _PID=1234

# 按可执行路径
journalctl /usr/sbin/sshd

# 按用户ID
journalctl _UID=1000
```

### 3. 组合查询

```bash
# 组合查询示例
journalctl -u mysql.service --since today -p err + _PID=5678
```

## 三、输出控制

### 1. 输出格式

```bash
# 简洁输出（仅消息）
journalctl -o cat

# JSON格式（脚本处理）
journalctl -o json

# 详细元数据
journalctl -o verbose
```

### 2. 显示控制

```bash
# 倒序显示（最新在前）
journalctl -r

# 限制条目数量
journalctl -n 20

# 禁用分页器
journalctl --no-pager
```

## 四、日志管理

### 1. 磁盘空间管理

```bash
# 检查日志大小
journalctl --disk-usage

# 清理旧日志
sudo journalctl --vacuum-time=2weeks
sudo journalctl --vacuum-size=500M
```

### 2. 导出日志

```bash
# 导出到文件
journalctl -u nginx --since "2023-01-01" > nginx_logs.txt
```

## 五、常用命令速查表

| 命令                                 | 功能           |
| ---------------------------------- | ------------ |
| `journalctl -f`                    | 实时追踪日志       |
| `journalctl -k`                    | 查看内核日志       |
| `journalctl -b -2`                 | 查看上上次启动日志    |
| `journalctl --since "1 hour ago"`  | 最近1小时日志      |
| `journalctl -p 3 -x`               | 错误日志含解释      |
| `journalctl /usr/bin/dockerd`      | Docker守护进程日志 |
| `sudo journalctl --vacuum-files=5` | 保留5个日志文件     |

> **重要提示**：
>
> 1. 查看完整系统日志需要 `sudo` 权限
>
> 2. 持久化存储需创建目录：
>
>    ```bash
>    sudo mkdir -p /var/log/journal
>    sudo systemd-tmpfiles --create --prefix /var/log/journal
>    sudo systemctl restart systemd-journald
>    ```
>
> 3. 配置文件路径：`/etc/systemd/journald.conf`
