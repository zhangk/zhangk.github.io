<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZhangK's Private Blog</title>
    <style>
        /* åˆå§‹çŠ¶æ€ï¼šæ˜¾ç¤ºå¯†ç é¡µï¼Œéšè—åšå®¢å®¹å™¨ */
        #blogContainer {
            display: none;
        }
        .auth-body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .auth-box {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        input, button { padding: 12px; margin: 5px; }
    </style>
    {{ partial "blog-data.html" . }}
</head>
<body class="auth-body">

    <!-- å¯†ç éªŒè¯ç•Œé¢ -->
    <div id="authBox" class="auth-box">
        <h2>ğŸ”’ ç§äººåšå®¢</h2>
        <p>è¯·è¾“å…¥è®¿é—®å¯†ç ï¼š</p>
        <input type="password" id="passwordInput" placeholder="å¯†ç " autofocus />
        <button onclick="validatePassword()">è¿›å…¥</button>
        <p id="errorMsg" style="color: red; display: none;">å¯†ç é”™è¯¯</p>
    </div>

    <!-- åšå®¢å†…å®¹å®¹å™¨ (éªŒè¯åæ˜¾ç¤º) -->
    <div id="blogContainer">
        <!-- è¿™é‡Œå°†ç”±JavaScriptåŠ¨æ€å¡«å……åšå®¢æ ‡é¢˜å’Œæ–‡ç« åˆ—è¡¨ -->
        <h1>æˆ‘çš„åšå®¢</h1>
        <div id="articleList"></div>
    </div>

    <script>
        // ========== é…ç½® ==========
        // !!! é‡è¦ï¼šæ›¿æ¢ä¸ºä½ çš„å¯†ç å“ˆå¸Œ !!!
        const correctHash = 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f';
        // æˆ‘ä»¬å°†ä»Hugoæ¨¡æ¿æ³¨å…¥çš„æ–‡ç« æ•°æ®
        const siteData = window.__HUGO_SITE_DATA__ || { pages: [] };

        // ========== ä¸»é€»è¾‘ ==========
        window.addEventListener('DOMContentLoaded', () => {
            const savedHash = localStorage.getItem('auth_hash');
            
            if (savedHash === correctHash) {
                // å·²è®¤è¯ï¼Œç›´æ¥æ˜¾ç¤ºåšå®¢
                showBlogContent();
            } else {
                // æœªè®¤è¯ï¼Œæ˜¾ç¤ºå¯†ç ç•Œé¢
                document.body.classList.add('auth-body');
                document.getElementById('authBox').style.display = 'block';
            }
        });

        async function validatePassword() {
            const input = document.getElementById('passwordInput').value;
            const encoder = new TextEncoder();
            const data = encoder.encode(input);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const inputHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            if (inputHash === correctHash) {
                // 1. ä¿å­˜è®¤è¯çŠ¶æ€
                localStorage.setItem('auth_hash', inputHash);
                // 2. åˆ‡æ¢ç•Œé¢
                showBlogContent();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function showBlogContent() {
            // 1. éšè—å¯†ç ç•Œé¢ï¼Œç§»é™¤å…¶æ ·å¼
            document.getElementById('authBox').style.display = 'none';
            document.body.classList.remove('auth-body');
            // 2. æ˜¾ç¤ºåšå®¢å®¹å™¨
            const blogContainer = document.getElementById('blogContainer');
            blogContainer.style.display = 'block';
            // 3. åŠ¨æ€ç”Ÿæˆå¹¶æ’å…¥æ–‡ç« åˆ—è¡¨
            renderArticleList();
        }

        function renderArticleList() {
            const container = document.getElementById('articleList');
            if (!siteData.pages || siteData.pages.length === 0) {
                container.innerHTML = '<p>æš‚æ— æ–‡ç« ã€‚</p>';
                return;
            }
            let html = '<ul>';
            // å…³é”®ä¿®æ”¹ï¼šå°†è¿‡æ»¤æ¡ä»¶ä» "post" æ”¹ä¸º "posts"
            const articles = siteData.pages
                .filter(p => p.type === 'posts') // <-- è¿™é‡Œæ”¹æˆ 'posts'
                .sort((a, b) => new Date(b.date) - new Date(a.date));
        
            articles.forEach(article => {
                html += `
                    <li>
                        <a href="${article.permalink}">
                            <strong>${article.title}</strong>
                        </a>
                        <span style="color:#666; font-size:0.9em;"> - ${formatDate(article.date)}</span>
                    </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;
        }

        function formatDate(dateStr) {
            // æ¸…ç†å¯èƒ½å­˜åœ¨çš„å¤šä½™å¼•å·
            const cleanDateStr = dateStr.replace(/^"|"$/g, '');
            return new Date(cleanDateStr).toLocaleDateString('zh-CN');
        }
    </script>
</body>
</html>
