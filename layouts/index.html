{{ define "main" }}
<!doctype html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <!-- è®©Hugoæ’å…¥ä¸»é¢˜çš„æ‰€æœ‰å¤´éƒ¨å…ƒç´ ï¼ˆCSSã€Metaç­‰ï¼‰ -->
    {{ partial "head.html" . }}
    <style>
        /* æˆ‘ä»¬è‡ªå®šä¹‰çš„å¯†ç é¡µæ ·å¼ï¼Œä»…åœ¨æœªè®¤è¯æ—¶ç”Ÿæ•ˆ */
        .auth-body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .auth-box { background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,.1); text-align: center; }
        #blogContainer { display: none; } /* åˆå§‹éšè—åšå®¢å®¹å™¨ */
    </style>
    <!-- æ³¨å…¥æ–‡ç« æ•°æ® -->
    {{ partial "blog-data.html" . }}
</head>
<body class="auth-body">
    <!-- å¯†ç éªŒè¯ç•Œé¢ -->
    <div id="authBox" class="auth-box">
        <h2>ğŸ”’ ç§äººåšå®¢</h2>
        <p>è¯·è¾“å…¥è®¿é—®å¯†ç ï¼š</p>
        <input type="password" id="passwordInput" placeholder="å¯†ç " autofocus />
        <button onclick="validatePassword()">è¿›å…¥</button>
        <p id="errorMsg" style="color: red; display: none;">å¯†ç é”™è¯¯</p>
    </div>

    <!-- åšå®¢å†…å®¹å®¹å™¨ (éªŒè¯åæ˜¾ç¤º) -->
    <!-- è¿™é‡Œå°†åŒ…è£¹æ•´ä¸ªä¸»é¢˜çš„ body å†…å®¹ -->
    <div id="blogContainer">
        <!-- ä¸»é¢˜çš„å¤´éƒ¨å¯¼èˆªæ  (åº”åŒ…å«æœç´¢æ¡†) -->
        {{ partial "header.html" . }}
        
        <!-- ä¸»é¢˜çš„ä¸»å†…å®¹åŒºåŸŸ -->
        <main>
            <!-- è¿™é‡Œå¯ä»¥æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼Œæˆ‘ä»¬ç¨åå¡«å…… -->
            <div id="dynamicContent">
                <h1>æˆ‘çš„åšå®¢</h1>
                <div id="articleList"></div>
            </div>
        </main>
        
        <!-- ä¸»é¢˜çš„é¡µè„šç­‰ -->
        {{ partial "footer.html" . }}
    </div>

    <!-- è®©Hugoæ’å…¥ä¸»é¢˜çš„æ‰€æœ‰å°¾éƒ¨JSï¼ˆåŒ…æ‹¬æœç´¢åŠŸèƒ½ï¼‰ -->
    {{ partial "foot.html" . }}

    <script>
        const correctHash = 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f';
        const siteData = window.__HUGO_SITE_DATA__ || { pages: [] };

        window.addEventListener('DOMContentLoaded', () => {
            const savedHash = localStorage.getItem('auth_hash');
            if (savedHash === correctHash) {
                showBlogContent();
            }
        });

        async function validatePassword() {
            const input = document.getElementById('passwordInput').value;
            const encoder = new TextEncoder();
            const data = encoder.encode(input);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const inputHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            if (inputHash === correctHash) {
                localStorage.setItem('auth_hash', inputHash);
                showBlogContent();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        function showBlogContent() {
            // éšè—å¯†ç ç•Œé¢
            document.getElementById('authBox').style.display = 'none';
            document.body.classList.remove('auth-body');
            // æ˜¾ç¤ºåšå®¢å®¹å™¨ï¼ˆæ­¤æ—¶ä¸»é¢˜çš„CSSã€JSéƒ½å·²åŠ è½½ï¼‰
            document.getElementById('blogContainer').style.display = 'block';
            // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
            renderArticleList();
        }

        function renderArticleList() {
            const container = document.getElementById('articleList');
            if (!siteData.pages || siteData.pages.length === 0) {
                container.innerHTML = '<p>æš‚æ— æ–‡ç« ã€‚</p>';
                return;
            }
            let html = '';
            const articles = siteData.pages
                .filter(p => p.type.replace(/^"|"$/g, '') === 'posts')
                .sort((a, b) => new Date(b.date.replace(/^"|"$/g, '')) - new Date(a.date.replace(/^"|"$/g, '')));

            // ä½¿ç”¨æ›´ç¬¦åˆä¸»é¢˜é£æ ¼çš„HTMLç»“æ„æ¥æ¸²æŸ“åˆ—è¡¨
            articles.forEach(article => {
                const cleanTitle = article.title.replace(/^"|"$/g, '');
                const cleanPermalink = article.permalink.replace(/^"|"$/g, '');
                const cleanDate = article.date.replace(/^"|"$/g, '');
                html += `
                    <article class="post-entry">
                        <header class="entry-header">
                            <h2><a href="${cleanPermalink}">${cleanTitle}</a></h2>
                        </header>
                        <div class="entry-content">
                            <p><time datetime="${cleanDate}">${new Date(cleanDate).toLocaleDateString('zh-CN')}</time></p>
                        </div>
                    </article>
                `;
            });
            container.innerHTML = html;
        }
    </script>
</body>
</html>
{{ end }}
